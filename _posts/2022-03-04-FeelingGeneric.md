---
Layout: post
title: Feeling generic?
Author_profile: true
Tags: 'PowerShell, ActiveDirectory, Automation'
published: false
date: '2022-03-04'
---

Each company has external contractors they employ only for a fixed period of time.<br>
Some of these workers are given a corporate account with a laptop, a phone, ... .<br>
Others are not so lucky but are still required to use some of our corporate applications.<br>
For these contractors, we offer them a generic account. This allows them to connect and use a particular app and only that app.<br>

In the past, a generic account was created by a Service Desk employee. Manual work isn't fun and it is prone to mistakes.<br>
Service Desk employee 1 would use CAPS in the name, others would not.<br>
Some employees respected the naming conventions whereas others would get more "creative".<br>

A contractor is by definition only with us for a set period of time. This is managed by the `AccountExpirationDate` in Active Directory.<br>
Of course when a contract was extended, a new ticket was created and Service Desk needed to manually extend the account.<br>
If the ticket got created at the very last minute (rarely happens ... ) , then there was an issue because the account wasn't extended in time.<br>

I was asked to automate and "smoothen the process" as much as possible.<br>
The project ended up with 3 PowerShell scripts and one small GUI i made in Powershell Studio by Sapien.<br>

- New-GenericAccount.ps1
- Get-GenericExpiredAccounts.ps1
- Set-ExtendedExpirationDate.ps1


The 3 scripts were obfuscated and are available over at http://www.github.com <br>
** Please note that this obfuscation might have a slight impact on the scripts logic/outlook. ** <br>

## New-GenericAccount.ps1 ##
The first script that was written, contains a function New-GenericAccount and can be used as follows:<br>

`New-ADGenericAccount -GivenName My -Surname Name -mail my.name@mypersonalmail.com -Application JIRA -mananger 12345`

Upon account creation, an email is send to the manager, informing them the account was created and the worker can start. <br>
The username and password (randomly generated by a different function), are sent to the personal email address of the contractor in two seperate emails for security reasons.

## Get-GenericExpiredAccounts.ps1 ##
This script is triggered by a scheduled task on a daily basis. It looks for all generic accounts matching a certain prefix. <br>
It looks at the account expiration dates. IF the account is to expire in exactly 15 or 30 days, the manager will receive an email to inform them. <br> 
When there was no data to be processed, only our team will receive an email. <br>
This way, we are informed that the task has run succesfully.

## Account Extension Manager (GUI) ##
<br>
![]({{site.baseurl}}/assets/images/FeelingGeneric/FeelingGeneric1.png)

At this point, the manager has received a notification of an about to expire generic account. <br>
If the contractor will remain with the company just a bit longer, the manager can ask for an account extension via the GUI. <br>
Once the manager clicks the button, the request is exported into a CSV-file.

## Set-ExtendedExpirationDate.ps1 ##
This brings us to the final script. This is also scheduled to run on a daily basis. <br>
It picks up the CSV that was created by the managers request and extends the accounts in Active Directory. <br>
Both the manager aswell as our team (Infrastructure Windows Server Engineers) will get an email notifying them the extension was succesfull. <br>
When there was no data to be processed, only our team will receive an email. This way, we are informed that the task has run succesfully. <br>

## Pester ##
I took this project as an opportunity to dip my toe into the world of Pester testing. <br> 
In the repository you'll also find a file named `New-GenericAccount.Tests.ps1`.

I mainly sticked to writing IntegrationTests. I am happy i gave this a shot as i did find value to writing these tests. <br>
The downside is that it requires more time, but the upside is that once you write them, it saves you time. <br>
 If time allows it, i'd like to start using these just a tad more in the future.<br>

Anyway, that was it for now.

K.